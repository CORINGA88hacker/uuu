<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TikTok Clone</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body, html { height: 100%; background: black; font-family: sans-serif; color: white; }
    #auth, #painel {
      width: 100%; height: 100%;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      background: black; padding: 20px;
    }
    input, button {
      margin: 10px; padding: 12px; font-size: 16px; border-radius: 8px; border: none;
    }
    button {
      background: #ff0050; color: white; cursor: pointer;
    }
    header {
      width: 100%; padding: 10px;
      background: rgba(0, 0, 0, 0.5);
      text-align: center;
    }
    nav {
      display: flex; justify-content: space-around; margin: 20px 0; width: 100%;
    }
    nav button {
      flex: 1; margin: 0 5px; padding: 10px;
      background: #222; color: white; border-radius: 8px;
      cursor: pointer;
    }
    .publicar, .ver-publicacoes {
      display: none; width: 100%;
      flex-direction: column; align-items: center;
    }
    .video-container {
      height: 100vh; scroll-snap-align: start; position: relative;
    }
    video {
      width: 100%; height: 100%; object-fit: cover;
    }
    .info {
      position: absolute; bottom: 100px; left: 10px; font-size: 16px;
      text-shadow: 0 0 5px black;
    }
    .actions {
      position: absolute; right: 10px; bottom: 100px;
      display: flex; flex-direction: column; gap: 20px; font-size: 24px;
      user-select: none;
    }
    .actions span {
      cursor: pointer; background: rgba(0,0,0,0.5);
      padding: 8px; border-radius: 10px;
      user-select: none;
    }
    .feed {
      height: 100vh; overflow-y: scroll; scroll-snap-type: y mandatory;
      width: 100%;
    }
  </style>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-storage-compat.js"></script>
</head>
<body>

  <div id="auth">
    <input type="text" id="email" placeholder="Email" />
    <input type="password" id="senha" placeholder="Senha" />
    <div>
      <button onclick="cadastrar()">Cadastrar</button>
      <button onclick="logar()">Entrar</button>
    </div>
  </div>

  <div id="painel" style="display:none">
    <header>
      <p id="userInfo"></p>
    </header>

    <nav>
      <button onclick="mostrarPublicar()">Publicar</button>
      <button onclick="mostrarFeed()">Ver Publica√ß√µes</button>
      <button onclick="logout()" style="background:#444; margin-left: 5px;">Sair</button>
    </nav>

    <div class="publicar" id="publicar">
      <input type="file" id="videoInput" accept="video/*" />
      <button onclick="enviarVideo()">Enviar</button>
    </div>

    <div class="ver-publicacoes" id="ver-publicacoes">
      <div id="feed" class="feed"></div>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBHIc2E4XwRO5FXo4uHlTQVRArOis73MjE",
      authDomain: "projeto-deus-yato-928-sk-default-rtdb.firebaseapp.com",
      databaseURL: "https://projeto-deus-yato-928-sk-default-rtdb.firebaseio.com",
      projectId: "projeto-deus-yato-928-sk-default-rtdb",
      storageBucket: "projeto-deus-yato-928-sk.appspot.com",
      messagingSenderId: "790408726854",
      appId: "1:790408726854:android:e2f0de7b7d5dba96b0fd47"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();
    const storage = firebase.storage();

    // Cadastro e login
    function cadastrar() {
      const email = document.getElementById("email").value.trim();
      const senha = document.getElementById("senha").value.trim();
      if (!email || !senha) {
        alert("Preencha email e senha.");
        return;
      }
      auth.createUserWithEmailAndPassword(email, senha)
        .then(() => alert("Cadastrado com sucesso!"))
        .catch(e => alert(e.message));
    }

    function logar() {
      const email = document.getElementById("email").value.trim();
      const senha = document.getElementById("senha").value.trim();
      if (!email || !senha) {
        alert("Preencha email e senha.");
        return;
      }
      auth.signInWithEmailAndPassword(email, senha)
        .then(user => {
          mostrarPainel(user.user);
        })
        .catch(e => alert(e.message));
    }

    function mostrarPainel(user) {
      document.getElementById("auth").style.display = "none";
      document.getElementById("painel").style.display = "flex";
      document.getElementById("userInfo").innerText = `Logado como: ${user.email}`;
      mostrarFeed();
    }

    // Logout
    function logout() {
      auth.signOut().then(() => {
        document.getElementById("painel").style.display = "none";
        document.getElementById("auth").style.display = "flex";
        document.getElementById("userInfo").innerText = "";
        document.getElementById("feed").innerHTML = "";
        document.getElementById("videoInput").value = "";
        mostrarPublicar();
      });
    }

    // Upload v√≠deo
    function uploadVideo(file) {
      const user = auth.currentUser;
      if (!user) {
        alert("Fa√ßa login para enviar v√≠deos.");
        return;
      }

      const videoRef = storage.ref("videos/" + Date.now() + "_" + file.name);
      const uploadTask = videoRef.put(file);

      uploadTask.on('state_changed',
        () => {}, // Progresso pode ser implementado aqui
        error => alert("Erro no upload: " + error.message),
        () => {
          uploadTask.snapshot.ref.getDownloadURL().then(url => {
            const videoData = {
              url,
              autor: user.email,
              curtidas: 0,
              timestamp: Date.now()
            };
            db.ref("videos").push(videoData);
            alert("V√≠deo enviado com sucesso!");
            carregarFeed();
            document.getElementById("videoInput").value = "";
            mostrarFeed();
          });
        }
      );
    }

    // Enviar v√≠deo - chama uploadVideo
    function enviarVideo() {
      const file = document.getElementById("videoInput").files[0];
      if (!file) {
        alert("Selecione um v√≠deo para enviar.");
        return;
      }
      uploadVideo(file);
    }

    // Mostrar se√ß√µes
    function mostrarPublicar() {
      document.getElementById('publicar').style.display = 'flex';
      document.getElementById('ver-publicacoes').style.display = 'none';
    }

    function mostrarFeed() {
      document.getElementById('publicar').style.display = 'none';
      document.getElementById('ver-publicacoes').style.display = 'flex';
      carregarFeed();
    }

    // Carregar feed
    function carregarFeed() {
      db.ref("videos").orderByChild("timestamp").once("value", snapshot => {
        const feed = document.getElementById("feed");
        feed.innerHTML = "";

        snapshot.forEach(child => {
          const data = child.val();
          const key = child.key;

          const container = document.createElement("div");
          container.className = "video-container";

          container.innerHTML = `
            <video src="${data.url}" controls></video>
            <div class="info">Autor: ${data.autor}</div>
            <div class="actions">
              <span onclick="curtir('${key}')">‚ù§Ô∏è ${data.curtidas || 0}</span>
              <span>üí¨ Coment√°rios</span>
            </div>
          `;

          feed.prepend(container);
        });
      });
    }

    // Curtir v√≠deo
    function curtir(key) {
      const likeRef = db.ref(`videos/${key}/curtidas`);
      likeRef.transaction(curtidas => (curtidas || 0) + 1);
      carregarFeed();
    }

    // Mant√©m login ativo
    auth.onAuthStateChanged(user => {
      if (user) {
        mostrarPainel(user);
      } else {
        document.getElementById("painel").style.display = "none";
        document.getElementById("auth").style.display = "flex";
      }
    });

    // Ao carregar, mostra publicar por padr√£o
    window.onload = () => {
      mostrarPublicar();
    };
  </script>
</body>
</html>
